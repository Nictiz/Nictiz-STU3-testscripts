<?xml version="1.0" encoding="UTF-8"?>
<TestScript xmlns="http://hl7.org/fhir" xmlns:nictiz="http://nictiz.nl/xsl/testscript">
    <id value="medmij-questionnaires-fhir3-0-1-phr-1.4-2.4"/>
    <name value="MedMij Questionnaires - PHR Client - Scenario 1.4 and 2.4"/>
    <description value="MedMij Questionnaires for FHIR STU3 - PHR Client - Scenario 1.4 and 2.4 - Retrieve QuestionnaireProvisioningTask with invalid reference, and reject QuestionnaireProvisioningTask"/>
    <nictiz:patientTokenFixture relPath="medmij-questionnaires-fhir3-0-1-nl-core-patient-BIE-token.xml"/>
    
    <nictiz:fixture id="task-requested-fixture" href="resources/resources-specific/medmij-questionnaires-fhir3-0-1-vl-QuestionnaireProvisioningTask-Bie-invalid-REQUESTED.xml"/>
    <nictiz:fixture id="task-update-fixture" href="resources/resources-specific/medmij-questionnaires-fhir3-0-1-vl-QuestionnaireProvisioningTask-Bie-invalid-FAILED.xml"/>
    
    <nictiz:profile id="Bundle-profile" value="http://hl7.org/fhir/StructureDefinition/Bundle"/>
    <!-- TODO: Enable when package is loaded -->
    <!-- <profile id="Task-profile" value="http://nictiz.nl/fhir/StructureDefinition/vl-QuestionnaireProvisioningTask"/> -->
    
    <nictiz:variables href="components/phr-variables-taskId.xml"/>
    <nictiz:includeDateT value="yes"/>
    
    <setup>
        <nictiz:actions href="components/phr-setup-checkForOpenTasks.xml"/>
        <nictiz:actions href="components/phr-setup-createTask.xml"/>
    </setup>
    
    <test id="Scenario1.4-SearchTask">
        <name value="Scenario1.4 - Search QuestionnaireProvisioningTask(s) for patient 3"/>
        <description value="Test PHR client to search for QuestionnaireProvisioningTasks with status 'requested'. The return value should be a Bundle with a single entry."/>
        <nictiz:actions href="components/phr-scenario1-searchTask.xml"/>
    </test>
    <test id="Scenario2.4-FailTask">
        <name value="Scenario2.4 - Set QuestionnaireProvisioningTask to 'failed'"/>
        <description value="Test PHR client to set the status of the QuestionnaireProvisioningTask to 'failed' when the Questionnaire cannot be retrieved."/>
        <nictiz:actions href="components/phr-operation-updateTask.xml"/>
        <nictiz:actions href="components/phr-assert-checkTaskUpdate.xml"/>
        <action>
            <assert>
                <description value="Confirm that the status of the Task is 'failed'"/>
                <direction value="request"/>
                <expression value="Task.status = 'failed'"/>
            </assert>
        </action>
    </test>            
    
    <teardown>
        <nictiz:actions href="components/phr-teardown-deleteTask.xml"/>
    </teardown>
</TestScript>
