<?xml version="1.0" encoding="UTF-8"?>
<actions xmlns="http://hl7.org/fhir" xmlns:nictiz="http://nictiz.nl/xsl/testscript">
    <action>
        <operation>
            <type>
                <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                <code value="search"/>
            </type>
            <resource value="Task"/>
            <description value="Test XIS server to serve QuestionnaireReferenceTask resources with status 'requested'."/>
            <destination value="1"/>
            <origin value="1"/>
            <params value="?code=http://loinc.org|74468-0&amp;status=requested"/>
            <requestHeader>
                <!-- 0..* Each operation can have one or more header elements -->
                <field value="Authorization"/>
                <!-- 1..1 HTTP header field name: OAuth access token -->
                <value value="${patient-token-id}"/>
                <!-- 1..1 HTTP headerfield value: UUID4 -->
            </requestHeader>
            <responseId value="search-response"/>
        </operation>
    </action>
    <action>
        <assert>
            <description value="Confirm that the returned resource type is Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
        </assert>
    </action>
    
    <nictiz:profile id="Bundle-profile" value="http://hl7.org/fhir/StructureDefinition/Bundle"/>
    <action>
        <assert>
            <description value="Confirm that the returned Bundle conforms to the base FHIR specification."/>
            <direction value="response"/>
            <validateProfileId value="Bundle-profile"/>
        </assert>
    </action>
    
    <action>
        <assert>
            <description value="Confirm that the returned Bundle type is searchset."/>
            <direction value="response"/>
            <operator value="equals"/>
            <path value="Bundle/type"/>
            <value value="searchset"/>
        </assert>
    </action>
    <action>
        <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 entry."/>
            <direction value="response"/>
            <expression value="Bundle.entry.count() = 1"/>
        </assert>
    </action>
    
</actions>
